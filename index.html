<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Blur Remover</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* –í–ê–ñ–ù–û: –§–∏–∫—Å –¥–ª—è "—á–µ—Ä–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞" - —Ä–∞—Å—Ç—è–≥–∏–≤–∞–µ–º –Ω–∞ 100% */
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: #000; /* –ß–µ—Ä–Ω—ã–π —Ñ–æ–Ω –Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ –∫–∞—Ä—Ç–∏–Ω–∫–∞ –Ω–µ –ø—Ä–æ–≥—Ä—É–∑–∏–ª–∞—Å—å */
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #container {
            position: relative;
            width: 100%;
            height: 100%;
            /* –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –º–∞–∫—Å —à–∏—Ä–∏–Ω—É, —á—Ç–æ–±—ã –Ω–∞ –ü–ö –Ω–µ –±—ã–ª–æ —Å–ª–∏—à–∫–æ–º —à–∏—Ä–æ–∫–æ */
            max-width: 100%; 
            max-height: 100%;
        }

        #clean-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover; /* –†–∞—Å—Ç—è–≥–∏–≤–∞–µ–º –∫–∞—Ä—Ç–∏–Ω–∫—É –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ */
            z-index: 1;
            opacity: 0; /* –°–∫—Ä—ã–≤–∞–µ–º –ø–æ–∫–∞ –Ω–µ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è */
            transition: opacity 0.5s ease;
        }

        canvas {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 2;
            touch-action: none;
        }

        /* Popup Styles */
        #popup {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 85%;
            background: rgba(24, 24, 24, 0.95);
            border: 2px solid #ff0055;
            border-radius: 20px;
            padding: 25px 15px;
            text-align: center;
            color: white;
            z-index: 100;
            box-shadow: 0 0 30px rgba(255, 0, 85, 0.6);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        .btn {
            background: linear-gradient(90deg, #ff0055, #ff4400);
            border: none;
            padding: 16px 0;
            color: white;
            font-size: 18px;
            font-weight: 700;
            border-radius: 12px;
            cursor: pointer;
            margin-top: 20px;
            width: 100%;
            text-transform: uppercase;
            box-shadow: 0 4px 15px rgba(255, 68, 0, 0.4);
        }
    </style>
</head>
<body>

<div id="container">
    <img id="clean-image" src="girl_clean.jpg" alt="Girl">
    <canvas id="blur-canvas"></canvas>
    
    <div id="popup">
        <h2 style="margin: 0 0 10px; font-size: 24px;">üîû –û—É, –ø–æ–ª–µ–≥—á–µ!</h2>
        <p style="margin: 0; opacity: 0.8; font-size: 15px; line-height: 1.4;">–•–æ—á–µ—à—å —É–≤–∏–¥–µ—Ç—å –ø–æ–ª–Ω—É—é –≤–µ—Ä—Å–∏—é –±–µ–∑ —Ü–µ–Ω–∑—É—Ä—ã?</p>
        <button class="btn" onclick="openSmartLink()">–í—Å—Ç—É–ø–∏—Ç—å –≤ VIP</button>
    </div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand(); 
    
    // –°—Å—ã–ª–∫—É –ª—É—á—à–µ —Ö–∞—Ä–¥–∫–æ–¥–∏—Ç—å —Å—é–¥–∞ –∏–ª–∏ –±—Ä–∞—Ç—å –∏–∑ URL params
    const VIP_LINK = "https://t.me/+vip_channel_link"; 

    const canvas = document.getElementById('blur-canvas');
    const ctx = canvas.getContext('2d', { willReadFrequently: true });
    const imgElement = document.getElementById('clean-image');
    const popup = document.getElementById('popup');
    const container = document.getElementById('container');
    
    let isDrawing = false;
    let gameEnded = false;

    // 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç–∏–Ω–∫–∏
    imgElement.onload = function() {
        imgElement.style.opacity = 1; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞—Ä—Ç–∏–Ω–∫—É
        resizeCanvas();
    };
    
    // –ï—Å–ª–∏ –∫–∞—Ä—Ç–∏–Ω–∫–∞ –∑–∞–∫—ç—à–∏—Ä–æ–≤–∞–Ω–∞
    if (imgElement.complete) {
        imgElement.style.opacity = 1;
        resizeCanvas();
    }
    
    // –§–æ–ª–±–µ–∫, –µ—Å–ª–∏ –∫–∞—Ä—Ç–∏–Ω–∫–∏ –Ω–µ—Ç - —Ä–∏—Å—É–µ–º —á–µ—Ä–Ω—ã–π –∫–≤–∞–¥—Ä–∞—Ç, —á—Ç–æ–±—ã –∏–≥—Ä–∞ —Ä–∞–±–æ—Ç–∞–ª–∞
    imgElement.onerror = function() {
        console.error("Image failed to load");
        resizeCanvas();
    }

    function resizeCanvas() {
        canvas.width = container.clientWidth;
        canvas.height = container.clientHeight;
        initBlurLayer();
    }

    function initBlurLayer() {
        // –†–∏—Å—É–µ–º —Å–ª–æ–π "—Ü–µ–Ω–∑—É—Ä—ã"
        // 1. –°–Ω–∞—á–∞–ª–∞ –∫–æ–ø–∏—Ä—É–µ–º –∫–∞—Ä—Ç–∏–Ω–∫—É
        ctx.drawImage(imgElement, 0, 0, canvas.width, canvas.height);
        
        // 2. –ù–∞–∫–ª–∞–¥—ã–≤–∞–µ–º —Å–∏–ª—å–Ω—ã–π –±–ª—é—Ä –∏ –∑–∞—Ç–µ–º–Ω–µ–Ω–∏–µ –ø–æ–≤–µ—Ä—Ö
        ctx.globalCompositeOperation = 'source-over';
        
        // –ú–æ–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –∑–∞–ª–∏—Ç—å –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º —Ü–≤–µ—Ç–æ–º + —Ç–µ–∫—Å—Ç, —á—Ç–æ–±—ã –Ω–µ –≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ—Ü –±–ª—é—Ä–æ–º
        ctx.fillStyle = 'rgba(0, 0, 0, 0.85)'; 
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        // –¢–µ–∫—Å—Ç
        ctx.font = "bold 30px sans-serif";
        ctx.fillStyle = "#ff0055";
        ctx.textAlign = "center";
        ctx.fillText("CENSORED", canvas.width/2, canvas.height/2);
        
        ctx.font = "16px sans-serif";
        ctx.fillStyle = "#ffffff";
        ctx.fillText("–°–æ—Ç—Ä–∏ –ø–∞–ª—å—Ü–µ–º", canvas.width/2, canvas.height/2 + 35);
    }

    // --- –†–∏—Å–æ–≤–∞–Ω–∏–µ ---
    function getPos(e) {
        const rect = canvas.getBoundingClientRect();
        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        const clientY = e.touches ? e.touches[0].clientY : e.clientY;
        return {
            x: clientX - rect.left,
            y: clientY - rect.top
        };
    }

    function startDraw(e) {
        if (gameEnded) return;
        isDrawing = true;
        draw(e);
    }

    function endDraw() {
        isDrawing = false;
        checkProgress();
    }

    function draw(e) {
        if (!isDrawing || gameEnded) return;

        const pos = getPos(e);
        
        ctx.globalCompositeOperation = 'destination-out'; // –õ–∞—Å—Ç–∏–∫
        ctx.beginPath();
        ctx.arc(pos.x, pos.y, 35, 0, Math.PI * 2, false); // –†–∞–∑–º–µ—Ä –∫–∏—Å—Ç–∏
        ctx.fill();
    }

    function checkProgress() {
        if (gameEnded) return;

        // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ 1 –ø–∏–∫—Å–µ–ª—å –∏–∑ 200
        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const data = imageData.data;
        let transparent = 0;
        let total = 0;

        for (let i = 3; i < data.length; i += 400) { // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø–∏–∫—Å–µ–ª–∏ –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏
            total++;
            if (data[i] < 50) { // –ï—Å–ª–∏ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –≤—ã—Å–æ–∫–∞—è
                transparent++;
            }
        }

        const percent = (transparent / total) * 100;
        console.log("Percent:", percent);

        if (percent > 25) { // 25% —Å—Ç–µ—Ä—Ç–æ
            gameEnded = true;
            popup.style.display = "block";
            tg.HapticFeedback.notificationOccurred('success');
        }
    }

    function openSmartLink() {
        tg.openLink(VIP_LINK);
    }

    window.addEventListener('resize', resizeCanvas);
    
    // Mouse
    canvas.addEventListener('mousedown', startDraw);
    window.addEventListener('mouseup', endDraw);
    canvas.addEventListener('mousemove', draw);
    
    // Touch
    canvas.addEventListener('touchstart', (e) => { e.preventDefault(); startDraw(e); }, {passive: false});
    window.addEventListener('touchend', endDraw);
    canvas.addEventListener('touchmove', (e) => { e.preventDefault(); draw(e); }, {passive: false});

</script>
</body>
</html>
