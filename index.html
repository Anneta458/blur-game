<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Blur Remover</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: #000;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #container {
            position: relative;
            width: 100%;
            height: 100%;
            max-width: 600px; /* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞ */
        }

        /* –ß–∏—Å—Ç–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (—Å–Ω–∏–∑—É) */
        #clean-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 1;
        }

        /* –ö–∞–Ω–≤–∞—Å (—Å–≤–µ—Ä—Ö—É) */
        canvas {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 2;
            touch-action: none; /* –í–∞–∂–Ω–æ –¥–ª—è –º–æ–±–∏–ª–æ–∫ */
            cursor: crosshair;
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
        #popup {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            background: rgba(20, 20, 20, 0.95);
            border: 2px solid #ff0055;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            color: white;
            z-index: 10;
            box-shadow: 0 0 20px rgba(255, 0, 85, 0.5);
            font-family: sans-serif;
        }

        .btn {
            background: linear-gradient(45deg, #ff0055, #ff5500);
            border: none;
            padding: 15px 30px;
            color: white;
            font-size: 18px;
            font-weight: bold;
            border-radius: 30px;
            cursor: pointer;
            margin-top: 15px;
            width: 100%;
        }
    </style>
</head>
<body>

<div id="container">
    <img id="clean-image" src="https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?q=80&w=1000&auto=format&fit=crop" alt="Girl">
    <canvas id="blur-canvas"></canvas>
    
    <div id="popup">
        <h2>üîû –û—É, –ø–æ–ª–µ–≥—á–µ!</h2>
        <p>–•–æ—á–µ—à—å —É–≤–∏–¥–µ—Ç—å –ø–æ–ª–Ω—É—é –≤–µ—Ä—Å–∏—é –±–µ–∑ —Ü–µ–Ω–∑—É—Ä—ã –∏ –±–ª—é—Ä–∞?</p>
        <button class="btn" onclick="openSmartLink()">–í—Å—Ç—É–ø–∏—Ç—å –≤ VIP</button>
    </div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand(); // –†–∞—Å–∫—Ä—ã—Ç—å –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω

    const canvas = document.getElementById('blur-canvas');
    const ctx = canvas.getContext('2d');
    const container = document.getElementById('container');
    const popup = document.getElementById('popup');
    
    let isDrawing = false;
    let clearedPixels = 0;
    let totalPixels = 0;
    let gameEnded = false;

    // –°—Å—ã–ª–∫–∞ –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å —á–µ—Ä–µ–∑ URL query params)
    const VIP_LINK = "https://example.com/smartlink"; 

    function resizeCanvas() {
        canvas.width = container.clientWidth;
        canvas.height = container.clientHeight;
        initBlurLayer();
    }

    function initBlurLayer() {
        // –ó–∞–ª–∏–≤–∞–µ–º –∫–∞–Ω–≤–∞—Å "–∑–∞–±–ª—é—Ä–µ–Ω–Ω–æ–π" –≤–µ—Ä—Å–∏–µ–π –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –ø–∏–∫—Å–µ–ª—è–º–∏
        // –î–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –∑–¥–µ—Å—å –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Å–ª–æ–π + —ç—Ñ—Ñ–µ–∫—Ç –±–ª—é—Ä–∞
        // –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –ª—É—á—à–µ –æ—Ç—Ä–∏—Å–æ–≤–∞—Ç—å image —á–µ—Ä–µ–∑ ctx.drawImage —Å filter = 'blur(20px)'
        
        const img = document.getElementById('clean-image');
        
        if (img.complete) {
            drawBlur(img);
        } else {
            img.onload = () => drawBlur(img);
        }
    }

    function drawBlur(img) {
        ctx.filter = 'blur(20px) brightness(0.8)'; // CSS —Ñ–∏–ª—å—Ç—Ä—ã –Ω–∞ –∫–∞–Ω–≤–∞—Å–µ
        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
        ctx.filter = 'none'; // –°–±—Ä–æ—Å —Ñ–∏–ª—å—Ç—Ä–∞
        
        // –î–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –Ω–∞—Ä–∏—Å–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç "CENSORED"
        ctx.font = "bold 40px Arial";
        ctx.fillStyle = "rgba(255, 255, 255, 0.5)";
        ctx.textAlign = "center";
        ctx.fillText("CENSORED", canvas.width/2, canvas.height/2);

        // –°—á–∏—Ç–∞–µ–º –ø–∏–∫—Å–µ–ª–∏ (–≥—Ä—É–±–∞—è –æ—Ü–µ–Ω–∫–∞ –æ–±—â–µ–π –ø–ª–æ—â–∞–¥–∏)
        totalPixels = canvas.width * canvas.height;
    }

    // --- –õ–æ–≥–∏–∫–∞ —Ä–∏—Å–æ–≤–∞–Ω–∏—è (–°—Ç–∏—Ä–∞–Ω–∏–µ) ---
    
    function startDraw(e) {
        if (gameEnded) return;
        isDrawing = true;
        draw(e);
    }

    function endDraw() {
        isDrawing = false;
        checkProgress();
    }

    function draw(e) {
        if (!isDrawing || gameEnded) return;

        const rect = canvas.getBoundingClientRect();
        const x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
        const y = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;

        ctx.globalCompositeOperation = 'destination-out'; // –†–µ–∂–∏–º –ª–∞—Å—Ç–∏–∫–∞
        ctx.beginPath();
        ctx.arc(x, y, 40, 0, Math.PI * 2, false); // –†–∞–∑–º–µ—Ä –∫–∏—Å—Ç–∏
        ctx.fill();
    }

    // --- –ü–æ–¥—Å—á–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ ---
    // –í–Ω–∏–º–∞–Ω–∏–µ: getImageData —Ç—è–∂–µ–ª–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è. –ù–µ –≤—ã–∑—ã–≤–∞—Ç—å –Ω–∞ –∫–∞–∂–¥—ã–π move.
    // –í—ã–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø—Ä–∏ endDraw (–æ—Ç–ø—É—Å–∫–∞–Ω–∏–∏ –ø–∞–ª—å—Ü–∞).
    
    function checkProgress() {
        if (gameEnded) return;

        // –ë–µ—Ä–µ–º —Å—ç–º–ø–ª—ã (–Ω–µ –∫–∞–∂–¥—ã–π –ø–∏–∫—Å–µ–ª—å –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏, –∞ –∫–∞–∂–¥—ã–π 10-–π)
        // –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π –∫–∞—É–Ω—Ç–µ—Ä based on strokes, –Ω–æ —Ç–æ—á–Ω–µ–µ —á–µ—Ä–µ–∑ getImageData
        
        // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ —Ü–µ–Ω—Ç—Ä –∏–ª–∏ –Ω–µ–±–æ–ª—å—à–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ
        // –î–ª—è –ø—Ä–∏–º–µ—Ä–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ (–º–æ–∂–µ—Ç –ª–∞–≥–∞—Ç—å –Ω–∞ —Å–ª–∞–±—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö)
        
        try {
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;
            let transparentPixels = 0;
            
            // data.length = width * height * 4 (rgba)
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–ª—å—Ñ–∞ –∫–∞–Ω–∞–ª (–∫–∞–∂–¥—ã–π 4-–π —ç–ª–µ–º–µ–Ω—Ç)
            // –®–∞–≥ += 400 (–ø—Ä–æ–≤–µ—Ä—è–µ–º 1 –ø–∏–∫—Å–µ–ª—å –∏–∑ 100 –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏)
            for (let i = 3; i < data.length; i += 400) { 
                if (data[i] < 10) { // –ï—Å–ª–∏ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –ø–æ—á—Ç–∏ –ø–æ–ª–Ω–∞—è
                    transparentPixels++;
                }
            }

            const totalSampled = data.length / 400;
            const percent = (transparentPixels / totalSampled) * 100;

            console.log("Cleared:", percent.toFixed(2) + "%");

            if (percent > 35) { // –ü–æ—Ä–æ–≥ 35%
                triggerWin();
            }
        } catch (e) {
            console.error(e);
        }
    }

    function triggerWin() {
        gameEnded = true;
        popup.style.display = "block";
        tg.HapticFeedback.notificationOccurred('success'); // –í–∏–±—Ä–∞—Ü–∏—è
    }

    function openSmartLink() {
        tg.openLink(VIP_LINK);
        // –ò–ª–∏ tg.close(), –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –∑–∞–∫—Ä—ã—Ç—å –∞–ø–ø –ø–æ—Å–ª–µ –∫–ª–∏–∫–∞
    }

    // --- Event Listeners ---
    window.addEventListener('resize', resizeCanvas);
    
    // Mouse
    canvas.addEventListener('mousedown', startDraw);
    canvas.addEventListener('mouseup', endDraw);
    canvas.addEventListener('mousemove', draw);
    
    // Touch
    canvas.addEventListener('touchstart', (e) => { e.preventDefault(); startDraw(e); }, {passive: false});
    canvas.addEventListener('touchend', (e) => { e.preventDefault(); endDraw(); }, {passive: false});
    canvas.addEventListener('touchmove', (e) => { e.preventDefault(); draw(e); }, {passive: false});

    // Init
    resizeCanvas();

</script>
</body>
</html>